steps:
# - script: echo dotnet-build
#   displayName: 'Build project'

- task: DotNetCoreCLI@2
  displayName: Restore
  inputs:
    command: restore
    projects: 02.Services/GoalKeeper.MApi/**/*.csproj

- task: DotNetCoreCLI@2
  displayName: Build
  inputs:
    command: build
    arguments: '--no-restore --configuration release'
    workingDirectory: ./02.Services/GoalKeeper.MApi/GoalKeeper.MApi.WebApi

- task: DotNetCoreCLI@2
  displayName: Test
  inputs:
    command: test
    arguments: '--configuration release /p:CollectCoverage=true /p:CoverletOutputFormat=cobertura /p:CoverletOutput=$(Build.SourcesDirectory)/TestResults/Coverage/'
    publishTestResults: true
    projects: 02.Services/GoalKeeper.MApi/**/*.UnitTests.csproj

# At present, the code coverage reporting functionality provided by this task is limited and it does not merge coverage data. 
# If you provide multiple files as input to the task, only the first match is considered. If you use multiple publish code 
# coverage tasks in the pipeline, the summary and report is shown for the last task. Any previously uploaded data is ignored.
# - task: PublishCodeCoverageResults@1
#   displayName: 'Publish code coverage report'
#   inputs:
#     codeCoverageTool: 'Cobertura'
#     summaryFileLocation: '$(Build.SourcesDirectory)/**/coverage.cobertura.xml'

# - script: |
#     ls -a
#     echo $(Build.SourcesDirectory)
#     ls -a $(Build.SourcesDirectory)
#   displayName: debug

#   MSBuild
# - task: DotNetCoreCLI@2
#   displayName: Test
#   inputs:
#     command: test
#     projects: 02.Services/GoalKeeper.MApi/**/*.UnitTests.csproj
#     arguments: '--configuration release --collect "Code coverage"'

# - script: dotnet test 02.Services/GoalKeeper.MApi/**/*.UnitTests.csproj --logger trx --collect "Code coverage"  
# - task: PublishTestResults@2
#   inputs:
#     testRunner: VSTest
#     testResultsFiles: '**/*.trx'